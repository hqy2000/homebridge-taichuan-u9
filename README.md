# Homebridge Taichuan U9

通过 **HomeKit** 解锁太川 Taichuan U9 小区单元楼门禁。  
搭配 **Home Hub**（Apple TV / HomePod / iPad）可实现 **远程解锁小区门禁**。

> 本插件通过模拟门禁 Pad 的呼叫与解锁流程，使门禁在 HomeKit 中表现为一个可控设备。



## 功能特性

- 🔓 在 HomeKit 中一键解锁单元楼门禁  
- 🌍 配合 Home Hub 支持远程解锁  
- 🏠 无需改动门禁硬件  
- 🔌 作为 Homebridge 插件运行，易于集成  



## 所需材料

- [ ] 一台可运行 **Homebridge** 的设备  
  - 树莓派  
  - NAS  
  - x86 主机等  
- [ ] 一台 **支持双 WAN / 多接口的路由器**  
  - 已刷 **OpenWRT**



## 网络与设备准备

### 1. 获取门禁 Pad 的 IP 地址

- 门禁 Pad 在 **WiFi 设置** 或 **工程设置** 中通常配置为 **静态 IP**
- 记录该 IP 地址
- 工程设置默认密码一般为：
  - `1234` 或 `123456`
- 若无法进入工程设置，请联系物业确认



### 2. 获取单元楼门禁主机的 IP 地址

- 在门禁 Pad 的 **工程设置** 中可查看
- 记录对应的单元楼门禁 IP 地址



### 3. 路由器配置（OpenWRT）

> 该步骤是整个方案的关键，用于接管门禁专用 VLAN 网络。

1. 光猫上通常存在一个 **绑定门禁系统的特殊接口（VLAN）**
2. 将该接口连接至路由器的 **WAN1**
   - **WAN0**：继续用于正常家庭宽带
3. WAN1 配置为 **静态 IP**
   - IP 地址填写为 **门禁 Pad 的静态 IP**
4. 配置策略路由：
   - 将 **门禁相关 IP 段** 路由至 WAN1
   - 其余流量仍然走 WAN0（正常上网）



### 4. 配置门禁 Pad（可选）

> 如果 **不需要门铃 / 视频通话功能**，可跳过此步骤。

1. 将门禁 Pad 连接至家庭 WiFi
2. 清除门禁 Pad 中的 **静态网络配置**
3. 设置为 **DHCP**
4. 在路由器中为门禁 Pad **绑定静态 IP**
5. 配置端口转发：
   - 将 **WAN1 的 UDP 30303** 转发至门禁 Pad



## 插件安装

### 通过 Homebridge UI 安装

1. 打开 Homebridge 管理界面
2. 搜索插件名称：`homebridge-taichuan-u9`
3. 安装完成后重启 Homebridge



### 配置样本

```json
{
    "accessory": "U9AccessControl",
    "name": "车库门禁",
    "ip": "172.16.2.1"
}
```

## 工作原理说明

> 太川门禁系统 **必须在呼叫状态下才能解锁**

插件在解锁流程中会按顺序执行：

1. 向门禁发起 **模拟呼叫**
2. 短暂等待系统进入可解锁状态
3. 发送 **解锁指令**
4. 门禁执行开门动作

整个过程对 HomeKit 用户而言表现为一次普通的“解锁”操作。



## 注意事项

* 门禁 IP、路由配置错误将导致无法解锁
* 某些小区 VLAN 配置存在差异，请自行确认光猫端口用途
* 本插件仅用于 **个人合法使用场景**



## 免责声明

本项目仅用于技术研究与个人自用，请确保你的使用行为 **符合当地法律法规及物业管理规定**。
作者不对因不当使用造成的任何后果负责。



## License

MIT
